name: Build and Release Installer
on:
  push:
    branches:
      - master
jobs:
  build:
    runs-on: windows-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      - name: Setup .NET Framework
        uses: Microsoft/setup-framework@v1
        with:
          dotnet-version: '4.8.1'
      - name: Restore NuGet packages
        run: nuget restore
      - name: Build application
        run: msbuild /p:Configuration=Release /t:Rebuild
      - name: Download WiX Toolset
        uses: jquintozamora/action-download-artifact@v2
        with:
          name: wix
          repository: wixtoolset/wix3
          pattern: 'wix*.zip'
        id: wix
      - name: Extract WiX Toolset
        run: |
          7z x ${{ steps.wix.outputs.artifact }} -y -oC:\wix
          setx Path "%PATH%;C:\wix\bin"
      - name: Create installer
        run: candle Product.wxs && light Product.wixobj -o ZacksOutliningToolInstaller.msi
      - name: Create Release
        uses: actions/create-release@v1
        with:
          tag_name: v1.0.0
          release_name: Release v1.0.0
          draft: false
          prerelease: false
      - name: Upload Installer
        uses: actions/upload-release-asset@v1
        with:
          upload_url: ${{ steps.create_release.outputs.upload_url }}
          asset_path: ./ZacksOutliningToolInstaller.msi
          asset_name: ZacksOutliningToolInstaller.msi
          asset_content_type: application/octet-stream
